<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tutorial 8 : Basic shading</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free tutorials for modern Opengl (3.3 and later) in C/C++">
    <link rel="canonical" href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-8-basic-shading/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="Tutorial%208%20%20%20Basic%20shading_soubory/main.css">
    <link href="Tutorial%208%20%20%20Basic%20shading_soubory/syntax.css" rel="stylesheet">

    <script async="" src="Tutorial%208%20%20%20Basic%20shading_soubory/analytics.js"></script><script>

      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-22633480-2', {'siteSpeedSampleRate': 40});
      ga('send', 'pageview');
      
    </script>
    
</head>


    <body>

    
    <header class="site-header">

  <script>
    String.prototype.replaceAt=function(index, character) {
    return this.substr(0, index) + character + this.substr(index+character.length);
    }
    
    function myFunction() {
    var x = document.getElementById("myLanguage").value
    var pageurl = "/beginners-tutorials/tutorial-8-basic-shading/"
    if (pageurl.charAt(3) == '/') {
      if(x=='en'){
        pageurl = pageurl.substring(3);
      } else {
        pageurl = pageurl.replaceAt(1, x);
      }
      window.open ('' + pageurl,'_self',false);
    } else { 
      window.open ('/' + x + pageurl,'_self',false);
    }
    
    
    }
  </script>
  
  <div class="wrap">
    
      <a class="site-title" href="http://www.opengl-tutorial.org/">opengl-tutorial</a>
    

    <nav class="site-nav">
      
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
        </svg>
      </a>

      <ul class="trigger">
        
        

        <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/">Basic tutorials</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-1-opening-a-window/">Tutorial 1 : Opening a window</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-2-the-first-triangle/">Tutorial 2 : The first triangle</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/">Tutorial 3 : Matrices</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-4-a-colored-cube/">Tutorial 4 : A Colored Cube</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-5-a-textured-cube/">Tutorial 5 : A Textured Cube</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-6-keyboard-and-mouse/">Tutorial 6 : Keyboard and Mouse</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-7-model-loading/">Tutorial 7 : Model loading</a></li>
                
              
            
              
              
            
              
              
            
              
              
                
                      
                  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-8-basic-shading/">Tutorial 8 : Basic shading</a></li>
                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/">Intermediate tutorials</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-9-vbo-indexing/">Tutorial 9 : VBO Indexing</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-10-transparency/">Tutorial 10 : Transparency</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-11-2d-text/">Tutorial 11 : 2D text</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-12-opengl-extensions/">Tutorial 12 : OpenGL Extensions</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-13-normal-mapping/">Tutorial 13 : Normal Mapping</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-14-render-to-texture/">Tutorial 14 : Render To Texture</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-15-lightmaps/">Tutorial 15 : Lightmaps</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-16-shadow-mapping/">Tutorial 16 : Shadow mapping</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/tutorial-17-quaternions/">Tutorial 17 : Rotations</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/billboards-particles/">Tutorial 18 : Billboards &amp; Particles</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/billboards-particles/billboards/">Billboards</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/intermediate-tutorials/billboards-particles/particles-instancing/">Particles / Instancing</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
            
              
              </ul></li>
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/miscellaneous/">Miscellaneous</a>
          <span class="arrow">▼</span>
          <ul class="sub-menu">
            
            
            
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/faq/">FAQ</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/contribute/">Contribute</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/contribute/translation/">Translation</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    </ul></li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/math-cheatsheet/">Math Cheatsheet</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/useful-tools-links/">Useful Tools &amp; Links</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/an-fps-counter/">An FPS counter</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/building-your-own-c-application/">Building your own C application</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    </li>
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/clicking-on-objects/">Clicking on objects</a>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                    
                    <span class="arrow">▶</span><ul class="sub-menu">
                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/clicking-on-objects/picking-with-an-opengl-hack/">Picking with an OpenGL hack</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/clicking-on-objects/picking-with-a-physics-library/">Picking with a physics library</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
                
                

                  
                  <li><a href="http://www.opengl-tutorial.org/miscellaneous/clicking-on-objects/picking-with-custom-ray-obb-function/">Picking with custom Ray-OBB function</a></li>

                
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
            
              
              </ul></li>
            
          </ul>
        </li>
        <li><a href="http://www.opengl-tutorial.org/download/">Download</a></li>


        <li><select id="myLanguage" onchange="myFunction()">
          
            <option value="en" selected="selected">english</option>	    
          
            <option value="cn">chinese</option>	    
          
            <option value="jp">japanese</option>	    
          
            <option value="ru">russian</option>	    
          
            <option value="fr">français</option>	    
          
	       </select></li>
       </ul>
      </nav></div>
    
  
</header>

    

    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Tutorial 8 : Basic shading</h1>
  </header>

  <article class="post-content">
  <p>In this 8th tutorial, we will learn how to do some basic shading. This includes :</p>

<ul>
  <li>Beeing more bright when closer to a light source</li>
  <li>Having highlights when looking in the reflection of a light (specular lighting)</li>
  <li>Beeing darker when light is not directly towards the model (diffuse lighting)</li>
  <li>Cheating a lot (ambient lighting)</li>
</ul>

<p>This does NOT include :</p>

<ul>
  <li>Shadows. This is a broad topic that deserves its own tutorial(s)</li>
  <li>Mirror-like reflections (this includes water)</li>
  <li>Any sophisticated light-matter interaction like subsurface scattering (like wax)</li>
  <li>Anisotrophic materials (like brushed metal)</li>
  <li>Physically based shading, which tries to mimic the reality closely</li>
  <li>Ambient Occlusion (it’s darker in a cave)</li>
  <li>Color Bleeding (a red carpet will make a white ceiling a litte bit red)</li>
  <li>Transparency</li>
  <li>Any kind of Global Illumination whatsoever (it’s the name that regroups all previous ones)</li>
</ul>

<p>In a word : Basic.</p>

<h1 id="normals">Normals</h1>

<p>During the last few tutorials you’ve been dealing with normal without really knowing what they were.</p>

<h2 id="triangle-normals">Triangle normals</h2>

<p>The normal of a plane is a vector of length 1 that is perpendicular to this plane.</p>

<p>The normal of a triangle is a vector of length 1 that is 
perpendicular to this triangle. It is easily computed by taking the 
cross product of two of its edges (the cross product of a and b produces
 a vector that is perpendicular to both a and b, remember ?), and 
normalized : its length is brought back to 1. In pseudo-code :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>triangle ( v1, v2, v3 )
edge1 = v2-v1
edge2 = v3-v1
triangle.normal = cross(edge1, edge2).normalize()
</code></pre>
</div>

<p>Don’t mix up normal and normalize(). Normalize() divides a vector 
(any vector, not necessarily a normal) by its length so that its new 
length is 1. normal is just the name for some vectors that happen to 
represent, well, a normal.</p>

<h2 id="vertex-normals">Vertex normals</h2>

<p>By extension, we call the normal of a vertex the combination of the 
normals of the surroundings triangles. This is handy because in vertex 
shaders, we deal with vertices, not triangles, so it’s better to have 
information on the vertex. And any way, we can’t have information on 
triangles in OpenGL. In pseudo-code :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>vertex v1, v2, v3, ....
triangle tr1, tr2, tr3 // all share vertex v1
v1.normal = normalize( tr1.normal + tr2.normal + tr3.normal )
</code></pre>
</div>

<h2 id="using-vertex-normals-in-opengl">Using vertex normals in OpenGL</h2>

<p>To use normals in OpenGL, it’s very easy. A normal is an attribute of
 a vertex, just like its position, its color, its UV coordinates… so 
just do the usual stuff. Our loadOBJ function from Tutorial 7 already 
reads them from the OBJ file.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="n">GLuint</span> <span class="n">normalbuffer</span><span class="p">;</span>
 <span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">normalbuffer</span><span class="p">);</span>
 <span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">normalbuffer</span><span class="p">);</span>
 <span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">normals</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">normals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</code></pre>
</div>

<p>and</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code> <span class="c1">// 3rd attribute buffer : normals
</span> <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">normalbuffer</span><span class="p">);</span>
 <span class="n">glVertexAttribPointer</span><span class="p">(</span>
     <span class="mi">2</span><span class="p">,</span>                                <span class="c1">// attribute
</span>     <span class="mi">3</span><span class="p">,</span>                                <span class="c1">// size
</span>     <span class="n">GL_FLOAT</span><span class="p">,</span>                         <span class="c1">// type
</span>     <span class="n">GL_FALSE</span><span class="p">,</span>                         <span class="c1">// normalized?
</span>     <span class="mi">0</span><span class="p">,</span>                                <span class="c1">// stride
</span>     <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span>                          <span class="c1">// array buffer offset
</span> <span class="p">);</span>
</code></pre>
</div>

<p>and this is enough to get us started.</p>

<h1 id="the-diffuse-part">The Diffuse part</h1>

<h2 id="the-importance-of-the-surface-normal">The importance of the surface normal</h2>

<p>When light hits an object, an important fraction of it is reflected 
in all directions. This is the “diffuse component”. (We’ll see what 
happens with the other fraction soon)</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuseWhite1.png" alt=""></p>

<p>When a certain flux of light arrives at the surface, this surface is 
illuminated differently according to the angle at which the light 
arrives.</p>

<p>If the light is perpendicular to the surface, it is concentrated on a
 small surface. If it arrives at a gazing angle, the same quantity of 
light spreads on a greater surface :</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuseAngle.png" alt=""></p>

<p>This means that each point of the surface will look darker with 
gazing light (but remember, more points will be illuminated, so the 
total quantity of light will remain the same)</p>

<p>This means that when we compute the colour of a pixel, the angle 
between the incoming light and the surface normal matters. We thus have :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="c1">// Cosine of the angle between the normal and the light direction,
// clamped above 0
//  - light is at the vertical of the triangle -&gt; 1
//  - light is perpendicular to the triangle -&gt; 0
</span><span class="kt">float</span> <span class="n">cosTheta</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span><span class="n">l</span> <span class="p">);</span>

<span class="n">color</span> <span class="o">=</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="p">;</span>
</code></pre>
</div>

<p>In this code, n is the surface normal and l is the unit vector that 
goes from the surface to the light (and not the contrary, even if it’s 
non inuitive. It makes the math easier).</p>

<h2 id="beware-of-the-sign">Beware of the sign</h2>

<p>Something is missing in the formula of our cosTheta. If the light is 
behind the triangle, n and l will be opposed, so n.l will be negative. 
This would mean that colour = someNegativeNumber, which doesn’t mean 
much. So we have to clamp cosTheta to 0 :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="c1">// Cosine of the angle between the normal and the light direction,
// clamped above 0
//  - light is at the vertical of the triangle -&gt; 1
//  - light is perpendicular to the triangle -&gt; 0
//  - light is behind the triangle -&gt; 0
</span><span class="kt">float</span> <span class="n">cosTheta</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span><span class="n">l</span> <span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="p">);</span>

<span class="n">color</span> <span class="o">=</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="material-color">Material Color</h2>

<p>Of course, the output colour also depends on the colour of the 
material. In this image, the white light is made out of green, red and 
blue light. When colliding with the red material, green and blue light 
is absorbed, and only the red remains.</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuseRed.png" alt=""></p>

<p>We can model this by a simple multiplication :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="n">color</span> <span class="o">=</span> <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="modeling-the-light">Modeling the light</h2>

<p>We will first assume that we have a punctual light that emits in all directions in space, like a candle.</p>

<p>With such a light, the luminous flux that our surface will receive 
will depend on its distance to the light source: the further away, the 
less light. In fact, the amount of light will diminish with the square 
of the distance :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="n">color</span> <span class="o">=</span> <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">cosTheta</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">);</span>
</code></pre>
</div>

<p>Lastly, we need another parameter to control the power of the light. 
This could be encoded into LightColor (and we will in a later tutorial),
 but for now let’s just have a color (e.g. white) and a power (e.g. 60 
Watts).</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="n">color</span> <span class="o">=</span> <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">cosTheta</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">);</span>
</code></pre>
</div>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>For this code to work, we need a handful of parameters (the various colours and powers) and some more code.</p>

<p>MaterialDiffuseColor is simply fetched from the texture.</p>

<p>LightColor and LightPower are set in the shader through GLSL uniforms.</p>

<p>cosTheta depends on n and l. We can express them in any space 
provided it’s the same for both. We choose the camera space because it’s
 easy to compute the light’s position in this space :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="c1">// Normal of the computed fragment, in camera space
</span> <span class="kt">vec3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span> <span class="n">Normal_cameraspace</span> <span class="p">);</span>
 <span class="c1">// Direction of the light (from the fragment to the light)
</span> <span class="kt">vec3</span> <span class="n">l</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span> <span class="n">LightDirection_cameraspace</span> <span class="p">);</span>
</code></pre>
</div>

<p>with Normal_cameraspace and LightDirection_cameraspace computed in the Vertex shader and passed to the fragment shader :</p>

<div class="language-glsl highlightglslvs highlighter-rouge"><pre class="highlight"><code><span class="c1">// Output position of the vertex, in clip space : MVP * position
</span><span class="nb">gl_Position</span> <span class="o">=</span>  <span class="n">MVP</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Position of the vertex, in worldspace : M * position
</span><span class="n">Position_worldspace</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>

<span class="c1">// Vector that goes from the vertex to the camera, in camera space.
// In camera space, the camera is at the origin (0,0,0).
</span><span class="kt">vec3</span> <span class="n">vertexPosition_cameraspace</span> <span class="o">=</span> <span class="p">(</span> <span class="n">V</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexPosition_modelspace</span><span class="p">,</span><span class="mi">1</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<span class="n">EyeDirection_cameraspace</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">vertexPosition_cameraspace</span><span class="p">;</span>

<span class="c1">// Vector that goes from the vertex to the light, in camera space. M is ommited because it's identity.
</span><span class="kt">vec3</span> <span class="n">LightPosition_cameraspace</span> <span class="o">=</span> <span class="p">(</span> <span class="n">V</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">LightPosition_worldspace</span><span class="p">,</span><span class="mi">1</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<span class="n">LightDirection_cameraspace</span> <span class="o">=</span> <span class="n">LightPosition_cameraspace</span> <span class="o">+</span> <span class="n">EyeDirection_cameraspace</span><span class="p">;</span>

<span class="c1">// Normal of the the vertex, in camera space
</span><span class="n">Normal_cameraspace</span> <span class="o">=</span> <span class="p">(</span> <span class="n">V</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">vertexNormal_modelspace</span><span class="p">,</span><span class="mi">0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span> <span class="c1">// Only correct if ModelMatrix does not scale the model ! Use its inverse transpose if not.
</span></code></pre>
</div>

<p>This code can seem impressive but it’s nothing we didn’t learn in 
Tutorial 3 : Matrices. I paid attention to write the name of the space 
in each vector’s name, so that keeping track of what is happening is 
much easier. <strong>You should do that, too.</strong></p>

<p>M and V are the Model and View matrices, which are passed to the shader in the exact same way as MVP.</p>

<h2 id="time-for-work">Time for work</h2>

<p>You’ve got everything you need to code a diffuse lighting. Go ahead, and learn the hard way :)</p>

<h2 id="result">Result</h2>

<p>With only the Diffuse component, we have the following result (sorry for the lame texture again) :</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuse_only.png" alt=""></p>

<p>It’s better than before, but there is still much missing. In 
particular, the back of Suzanne is completely black since we used 
clamp().</p>

<h1 id="the-ambient-component">The Ambient component</h1>

<p>The Ambient component is the biggest cheat ever.</p>

<p>We expect the back of Suzanne to be receive more light because in 
real life, the lamp would light the wall behind it, which would in turn 
(slightly less) light the back of the object.</p>

<p>This is awfully expensive to compute.</p>

<p>So the usual hack is to simply fake some light. In fact, is simply 
makes the 3D model *emit *light so that it doesn’t appear completely 
black.</p>

<p>This can be done this way :</p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="kt">vec3</span> <span class="n">MaterialAmbientColor</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">MaterialDiffuseColor</span><span class="p">;</span>
</code></pre>
</div>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="n">color</span> <span class="o">=</span>
 <span class="c1">// Ambient : simulates indirect lighting
</span> <span class="n">MaterialAmbientColor</span> <span class="o">+</span>
 <span class="c1">// Diffuse : "color" of the object
</span> <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">cosTheta</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">)</span> <span class="p">;</span>
</code></pre>
</div>

<p>Let’s see what it gives</p>

<h2 id="results">Results</h2>

<p>Ok so that’s a little bit better. You can adjust the (0.1, 0.1, 0.1) if you want better results.</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuse_ambiant.png" alt=""></p>

<h1 id="the-specular-component">The Specular component</h1>

<p>The other part of light that is reflected is reflected mostly in the 
direction that is the reflection of the light on the surface. This is 
the specular component.</p>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/specular.png" alt=""></p>

<p>As you can see in the image, it forms a kind of lobe. In extreme 
cases, the diffuse component can be null, the lobe can be very very very
 narrow (all the light is reflected in a single direction) and you get a
 mirror.</p>

<p>(<em>we can indeed tweak the parameters to get a mirror, but in our 
case, the only thing we take into account in this mirror is the lamp. So
 this would make for a weird mirror)</em></p>

<div class="language-glsl highlightglslfs highlighter-rouge"><pre class="highlight"><code><span class="c1">// Eye vector (towards the camera)
</span><span class="kt">vec3</span> <span class="n">E</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">EyeDirection_cameraspace</span><span class="p">);</span>
<span class="c1">// Direction in which the triangle reflects the light
</span><span class="kt">vec3</span> <span class="n">R</span> <span class="o">=</span> <span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="c1">// Cosine of the angle between the Eye vector and the Reflect vector,
// clamped to 0
//  - Looking into the reflection -&gt; 1
//  - Looking elsewhere -&gt; &lt; 1
</span><span class="kt">float</span> <span class="n">cosAlpha</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span> <span class="n">E</span><span class="p">,</span><span class="n">R</span> <span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="p">);</span>

<span class="n">color</span> <span class="o">=</span>
    <span class="c1">// Ambient : simulates indirect lighting
</span>    <span class="n">MaterialAmbientColor</span> <span class="o">+</span>
    <span class="c1">// Diffuse : "color" of the object
</span>    <span class="n">MaterialDiffuseColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">cosTheta</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">)</span> <span class="p">;</span>
    <span class="c1">// Specular : reflective highlight, like a mirror
</span>    <span class="n">MaterialSpecularColor</span> <span class="o">*</span> <span class="n">LightColor</span> <span class="o">*</span> <span class="n">LightPower</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">cosAlpha</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">);</span>
</code></pre>
</div>

<p>R is the direction in which the light reflects. E is the inverse 
direction of the eye (just like we did for “l”); If the angle between 
these two is little, it means we are looking straight into the 
reflection.</p>

<p>pow(cosAlpha,5) is used to control the width of the specular lobe. Increase 5 to get a thinner lobe.</p>

<h2 id="final-result">Final result</h2>

<p><img src="Tutorial%208%20%20%20Basic%20shading_soubory/diffuse_ambiant_specular.png" alt=""></p>

<p>Notice the specular highlights on the nose and on the eyebrows.</p>

<p>This shading model has been used for years due to its simplicity. It 
has a number of problems, so it is replaced by physically-based models 
like the microfacet BRDF, but we will see this later.</p>

<p>In the next tutorial, we’ll learn how to improve the performance of your VBO. This will be the first Intermediate tutorial !</p>

  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="footer-col-1 column">
      <ul>
        <li><a href="mailto:contact@opengl-tutorial.org">contact@opengl-tutorial.org</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <a href="https://github.com/opengl-tutorials/ogl" target="_blank">
        <span class="icon github">
          <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
            <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
            c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
            c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
            c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
            C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
            c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
            c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
            c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
            c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path>
          </svg>
        </span>
        <span class="username"></span>
      </a>
        
      <a href="https://twitter.com/GraphicsTut" target="_blank">
        <span class="icon twitter">
          <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
            <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
            c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
            c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
            c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
            C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
            c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
            c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path>
          </svg>
        </span>
        <span class="username"></span>
      </a>
      <a href="https://plus.google.com/107410003823545892786" target="_blank">
        <span class="icon gplus">
          <svg class="gplus-icon-svg" enable-background="new 0 0 128 128" height="128px" id="Layer_1" version="1.1" viewBox="0 0 128 128" width="128px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><g><circle cx="64" cy="64" fill="#C2C2C2" r="64"></circle><g><g><path d="M49.424,97.875c-19.018,0-34.491-15.193-34.491-33.874c0-18.68,15.473-33.875,34.491-33.875     c8.318,0,16.354,2.952,22.624,8.309l-8.771,9.899c-3.838-3.279-8.758-5.086-13.853-5.086c-11.652,0-21.13,9.31-21.13,20.752     c0,11.441,9.479,20.75,21.13,20.75c9.858,0,16.311-4.723,18.407-13.197H49.587V58.432h32.347v6.562     C81.934,84.659,68.869,97.875,49.424,97.875z" fill="#FFFFFF"></path></g><polygon fill="#FFFFFF" points="117.934,58.438 107.934,58.438 107.934,48.438 99.934,48.438 99.934,58.438 89.934,58.438     89.934,66.438 99.934,66.438 99.934,76.438 107.934,76.438 107.934,66.438 117.934,66.438   "></polygon></g></g>
          </svg>
        </span>
      </a>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Free tutorials for modern Opengl (3.3 and later) in C/C++</p>
    </div>

  </div>

</footer>


    
</body></html>